<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="style.css">
        <script src="data.js"></script>
    </head>

    <body>
        
        <div class="top-bar"><h1>My Forum</h1></div>

        <div class="main">

            <ul class="topics">
            </ul>
            
            <!--This the script for taking the data from the posts array in the .js file-->
            <script>
            var container = document.querySelector(".topics")
            for (let post of posts){
                var html = `
                <li class="row">
                        <h1 class="title">
                            <!--this is for directing the post links to the page url based on the post array's id and then later using the title as the header in that page-->
                            <a href="thread.html?id=${post.id}">${post.title}</a>
                        </h1>

                            <h4 class="postContent">${post.content}</h4>
                            <div class="bottom">
                                <!--shows the date the post was made as well as how many comments the post has-->
                                <p class="postAuthor">by ${post.author}</p>
                                <p class="timestamp">${new Date(post.date).toLocaleString()}</p>
                                <p class="comment-count">${post.comments.length} comments</p>
                            </div>
                </li>
                `
                container.insertAdjacentHTML('beforeend', html)
            }            
            </script>

            <!--This is for creating a new post-->
            <button newPost>Post a Quest</button>
            <dialog modal id="popUp">
                <h4>Title</h4>
                <textarea id="title"></textarea>
                <h4>Text</h4>
                <textarea id="descript"></textarea>
                <button submitPost>Submit</button>
                <button closePost>Close</button>
            </dialog>

        </div>

        <!--This is the script for the popup for submitting a topic-->
        <script>
            const popUp = document.querySelector("#popUp"); //For the pop up modal of the topic submission
            const openPop = document.querySelector("[newPost]"); //For the button that opens the popup for topic submission
            const closePop = document.querySelector("[closePost]"); //For the button that closes the topic submission popup
            openPop.addEventListener('click', () => {popUp.showModal();})
            closePop.addEventListener('click', () => {popUp.close();})
        </script>

        <script>
            //This function appends the new post into the html file
            function addPost(newPostValue){
                var container = document.querySelector(".topics")
                var newPostHTML = `
                <li class="row">
                    <h1 class="title">
                        <!--this is for the new user inputted title-->
                        <a href="thread.html?id=${newPostValue.id}">${newPostValue.title}</a>
                    </h1>
                    
                    <h4 class="postContent">${newPostValue.content}</h4>
 
                    <div class="bottom">
                        <!--shows the date the post was made as well as how many comments the post has-->
                        <p class="postAuthor">by ${newPostValue.author}</p>
                        <p class="timestamp">${new Date(newPostValue.date).toLocaleString()}</p>
                        <p class="comment-count">0 comments</p>
                    </div>
 
                    </li>
                `
                container.insertAdjacentHTML('beforeend', newPostHTML);
            }

            //This stores the data in the text area, and then runs the addComment function above to post it in the comments section, then clears the text area
            var postBTN = document.querySelector("[submitPost]");
            postBTN.addEventListener('click', function(){
                var postTitle = document.querySelector("#title");
                var postTxt = document.querySelector("#descript");
                var newPostValue = {
                    id: 3,
                    title: postTitle.value,
                    content: postTxt.value,
                    date: Date.now(),
                    author: "User"
                }
            addPost(newPostValue);
            postTitle.value = ""
            postTxt.value = ""
            popUp.close();
            })

            </script>

    </body>

</html>